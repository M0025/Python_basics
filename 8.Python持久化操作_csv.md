# Python持久化操作

标签（空格分隔）： Python

---
2018 07 04
##Python中操作csv
CSV： 通用的简单的文件格式，广泛应用
1.2 如何读取csv文件
```python
import csv
 #打开文件，用with打开
 with open('./销售相关企业信息.csv','r')as csvfile:  #作为一个变量名
     read = csv.reader(csvfile)
     for i in read:
        print(i)
```
1.3 如何写入csv文件
```python
import csv
#写csv
with open("./csvtest.csv",'w')as newcsv:
    writer = csv.writer(newcsv)
    writer.writerow(['id','url','keywords'])
    data = [
        ('1','http://www.xiaoheiseo.com/','小黑'),
        ('2', 'http://www.baidu.com/', '百度'),
        ('3', 'http://www.jd.com/', '京东'),
    ]
    writer.writerows(data)

with open('./csvtest.csv', 'r')as newcsv:
    readNewCsv = csv.reader(newcsv)
    for i in newcsv:
        print(i)
```
读取写入文件步骤：

 1. import csv 模块
 2. with open 路径，r/w 读写操作 as 文件名：
 3. 变量 = csv.writer（文件名）
 4. writer.writerow 字段名
 5. 定义数据 Data = []
 6. writer.writerows(data)
 7. 读取要遍历一下，for i in 文件名

利用xlrd模块对Excel进行操作
  
```
import xlrd
#读取本地csv文件，打开excel文件
myWorkbook = xlrd.open_workbook('./某公司贸易数据.xlsx')
#获取Excel工作表
mySheets = myWorkbook.sheets()
mySheet = mySheets[0]  #通过索引获取
mySheet1 = myWorkbook.sheet_by_index(1) #通过索引顺序获得
mySheet2 = myWorkbook.sheet_by_name('产品类别') #通过名字获取

#获取行数和列数

nrows = mySheet.nrows
ncols = mySheet.ncols
print('The row: %d'%nrows)
print('The cols:%d'%ncols)


#获取一行和一列

for i in range(nrows):
    myRowValues = mySheet.row_values(i)
    print(myRowValues)

for j in range(ncols):
    myColValues = mySheet.col_values(j)
    print(myColValues)


#读取单元格数据
for i in range(nrows):
    for j in range(ncols):
        mycell = mySheet.cell(i,j)   #获取单元格
        mycellValue = mycell.value #通过单元格获取
        print(mycellValue)

mycellValue = mySheet.col_values(0,0)  #直接获取单元格数据

#mySheet.cell_value(0,0) = "newValues" xlrd readonly
print(mycellValue)
```


```
#读csv
import csv
#打开文件，用with打开
with open('./销售相关企业信息.csv','r')as csvfile:  #作为一个变量名
    read = csv.reader(csvfile)
    for i in read:
        print(i)

#写csv
with open("./csvtest.csv",'w')as newcsv:
    writer = csv.writer(newcsv)
    writer.writerow(['id','url','keywords'])
    data = [
        ('1','http://www.xiaoheiseo.com/','小黑'),
        ('2', 'http://www.baidu.com/', '百度'),
        ('3', 'http://www.jd.com/', '京东'),
    ]
    writer.writerows(data)

with open('./csvtest.csv', 'r')as newcsv:
    readNewCsv = csv.reader(newcsv)
    for i in newcsv:
        print(i)

print(type(writer))

import xlrd
#读取本地csv文件，打开excel文件
myWorkbook = xlrd.open_workbook('./某公司贸易数据.xlsx')
#获取Excel工作表
mySheets = myWorkbook.sheets()
mySheet = mySheets[0]  #通过索引获取
mySheet1 = myWorkbook.sheet_by_index(1) #通过索引顺序获得
mySheet2 = myWorkbook.sheet_by_name('产品类别') #通过名字获取

#获取行数和列数
nrows = mySheet.nrows
ncols = mySheet.ncols
print('The row: %d'%nrows)
print('The cols:%d'%ncols)


#获取一行和一列
for i in range(nrows):
    myRowValues = mySheet.row_values(i)
    print(myRowValues)
for j in range(ncols):
    myColValues = mySheet.col_values(j)
    print(myColValues)


#读取单元格数据
for i in range(nrows):
    for j in range(ncols):
        mycell = mySheet.cell(i,j)   #获取单元格
        mycellValue = mycell.value #通过单元格获取
        print(mycellValue)
mycellValue = mySheet.col_values(0,0)  #直接获取单元格数据

#mySheet.cell_value(0,0) = "newValues" #xlrd readonly
print(mycellValue)

import xlwt
wbk = xlwt.Workbook()  #创建工作簿
sheet = wbk.add_sheet('表01')  #创建工作表
sheet.write(0,1,'test text')   #第一行第二列写入testtext'
wbk.save('./test.xls')      # 保存Excel文件
print("ok")

from xlutils.copy import copy
workbook = xlrd.open_workbook('./某公司贸易数据.xlsx')
workbooknew = copy(workbook)  #拷贝一份工作簿
ws = workbooknew.get_sheet(0) #获取第一张工作表
ws.write(3, 0, 'Changed!')    #根据索引修改对应的单元格数据
workbooknew.save('./northwind.xls')

# 4.openpyxl可以对Excel文件进行读写操作
from openpyxl import Workbook
from openpyxl import load_workbook
from openpyxl.writer.excel import ExcelWriter
workbook_ = load_workbook("./某公司贸易数据.xlsx")   #加载工作簿
sheetnames = workbook_.get_sheet_names() #获得所有表单名字
print(sheetnames)
sheet = workbook_.get_sheet_by_name('员工') #获取其中一张表单
print(sheet.cell(row=3, column=3).value)
sheet['A1'] = '47'
workbook_.save('./northwind_new.xlsx')

# 5.openpyxl也可以创建一张表

workbook_ = load_workbook('./某公司贸易数据.xlsx')
sheet1 = workbook_.create_sheet(index=7, title='newSheet')
sheet1['A1'] = 'hello'
sheet1['A2'] = 'world'
workbook_ .save('/.某公司贸易数据.xlsx')
```